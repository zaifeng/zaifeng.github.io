<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Dockerfile | 淡忘起初</title><meta property="og:title" content="Dockerfile - 淡忘起初"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-10-30T23:01:21+08:00"><meta property="article:modified_time" content="2022-10-30T23:01:21+08:00"><meta name=Keywords content="golang,go语言,go语言笔记,PHP etc."><meta name=description content="Dockerfile"><meta name=author content="zaifeng"><meta property="og:url" content="https://iforget.top/post/dockerfile/"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/style.css><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><a id=logo href=https://iforget.top>淡忘起初</a><p class=description>I have a beautiful dream</p></div><div><nav id=nav-menu class=clearfix><a class=current href=https://iforget.top>Home</a>
<a href=https://iforget.top/reading/ title=阅读>阅读</a>
<a href=https://iforget.top/life/ title=生活点滴>生活点滴</a>
<a href=https://iforget.top/debt/TechDebt/ title=技术债>技术债</a>
<a href=https://iforget.top/about/AboutMe title=关于>关于</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Dockerfile</h1></header><time datetime=2022-10-30T15:01:21Z class="post-meta meta-date dt-published">2022-10-30</time><div class="post-meta meta-category"><span>&nbsp;|</span>
<a href=/categories/docker target=_blank>docker</a></div><div class=post-content><h2 id=什么是dockerfile>什么是Dockerfile?</h2><p>Dockerfile是一个包含用于组合映像的命令的文本文档。可以使用在命令行中调用任何命令。 Docker通过读取<code>Dockerfile</code>中的指令自动生成映像。</p><p><code>docker build</code>命令用于从Dockerfile构建映像。可以在<code>docker build</code>命令中使用<code>-f</code>标志指向文件系统中任何位置的Dockerfile。</p><pre tabindex=0><code>$ docker build -f /path/to/a/Dockerfile
</code></pre><h2 id=dockerfile的基本结构>Dockerfile的基本结构</h2><p>Dockerfile 一般分为四部分：</p><ul><li><code>基础镜像信息</code></li><li><code>维护者信息</code></li><li><code>镜像操作指令</code></li><li><code>容器启动时执行指令</code></li></ul><blockquote><p><code>#</code> 为 Dockerfile 中的注释。</p></blockquote><h2 id=dockerfile文件说明>Dockerfile文件说明</h2><p>Docker以从上到下的顺序运行Dockerfile的指令。为了指定基本映像，第一条指令必须是<em>FROM</em>。一个声明以<code>＃</code>字符开头则被视为注释。可以在Docker文件中使用<code>RUN</code>，<code>CMD</code>，<code>FROM</code>，<code>EXPOSE</code>，<code>ENV</code>等指令。</p><p><strong>在这里列出了一些常用的指令。</strong></p><p><strong>FROM：指定基础镜像，必须为第一个命令</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span>格式：<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>　　FROM &lt;image&gt;<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>　　FROM &lt;image&gt;:&lt;tag&gt;<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>　　FROM &lt;image&gt;@&lt;digest&gt;<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>示例：<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>　　FROM mysql:5.6<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>注：<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>　　tag或digest是可选的，如果不使用这两个值时，会使用latest版本的基础镜像<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>RUN：构建镜像时执行的命令</strong></p><pre tabindex=0><code>RUN用于在镜像容器中执行命令，其有以下两种命令执行方式：
shell执行
格式：
    RUN &lt;command&gt;
exec执行
格式：
    RUN [&#34;executable&#34;, &#34;param1&#34;, &#34;param2&#34;]
示例：
    RUN [&#34;executable&#34;, &#34;param1&#34;, &#34;param2&#34;]
    RUN apk update
    RUN [&#34;/etc/execfile&#34;, &#34;arg1&#34;, &#34;arg1&#34;]
注：
　　RUN指令创建的中间镜像会被缓存，并会在下次构建中使用。如果不想使用这些缓存镜像，可以在构建时指定--no-cache参数，如：docker build --no-cache
</code></pre><p><strong>ADD：将本地文件添加到容器中，tar类型文件会自动解压(网络压缩资源不会被解压)，可以访问网络资源，类似wget</strong></p><pre tabindex=0><code>格式：
    ADD &lt;src&gt;... &lt;dest&gt;
    ADD [&#34;&lt;src&gt;&#34;,... &#34;&lt;dest&gt;&#34;] 用于支持包含空格的路径
示例：
    ADD hom* /mydir/          # 添加所有以&#34;hom&#34;开头的文件
    ADD hom?.txt /mydir/      # ? 替代一个单字符,例如：&#34;home.txt&#34;
    ADD test relativeDir/     # 添加 &#34;test&#34; 到 `WORKDIR`/relativeDir/
    ADD test /absoluteDir/    # 添加 &#34;test&#34; 到 /absoluteDir/
</code></pre><p><strong>COPY：功能类似ADD，但是是不会自动解压文件，也不能访问网络资源</strong></p><p><strong>CMD：构建容器后调用，也就是在容器启动时才进行调用。</strong></p><pre tabindex=0><code>格式：
    CMD [&#34;executable&#34;,&#34;param1&#34;,&#34;param2&#34;] (执行可执行文件，优先)
    CMD [&#34;param1&#34;,&#34;param2&#34;] (设置了ENTRYPOINT，则直接调用ENTRYPOINT添加参数)
    CMD command param1 param2 (执行shell内部命令)
示例：
    CMD echo &#34;This is a test.&#34; | wc -
    CMD [&#34;/usr/bin/wc&#34;,&#34;--help&#34;]
注：
 　　CMD不同于RUN，CMD用于指定在容器启动时所要执行的命令，而RUN用于指定镜像构建时所要执行的命令。
</code></pre><p><strong>ENTRYPOINT：配置容器，使其可执行化。配合CMD可省去"application"，只使用参数。</strong></p><pre tabindex=0><code>格式：
    ENTRYPOINT [&#34;executable&#34;, &#34;param1&#34;, &#34;param2&#34;] (可执行文件, 优先)
    ENTRYPOINT command param1 param2 (shell内部命令)
示例：
    FROM ubuntu
    ENTRYPOINT [&#34;top&#34;, &#34;-b&#34;]
    CMD [&#34;-c&#34;]
注：
　　　ENTRYPOINT与CMD非常类似，不同的是通过docker run执行的命令不会覆盖ENTRYPOINT，而docker run命令中指定的任何参数，都会被当做参数再次传递给ENTRYPOINT。Dockerfile中只允许有一个ENTRYPOINT命令，多指定时会覆盖前面的设置，而只执行最后的ENTRYPOINT指令。
</code></pre><p><strong>LABEL：用于为镜像添加元数据</strong></p><pre tabindex=0><code>格式：
    LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...
示例：
　　LABEL version=&#34;1.0&#34; description=&#34;这是一个Web服务器&#34; by=&#34;IT笔录&#34;
注：
　　使用LABEL指定元数据时，一条LABEL指定可以指定一或多条元数据，指定多条元数据时不同元数据之间通过空格分隔。推荐将所有的元数据通过一条LABEL指令指定，以免生成过多的中间镜像。
</code></pre><p><strong>ENV：设置环境变量</strong></p><pre tabindex=0><code>格式：
    ENV &lt;key&gt; &lt;value&gt;  #&lt;key&gt;之后的所有内容均会被视为其&lt;value&gt;的组成部分，因此，一次只能设置一个变量
    ENV &lt;key&gt;=&lt;value&gt; ...  #可以设置多个变量，每个变量为一个&#34;&lt;key&gt;=&lt;value&gt;&#34;的键值对，如果&lt;key&gt;中包含空格，可以使用\来进行转义，也可以通过&#34;&#34;来进行标示；另外，反斜线也可以用于续行
示例：
    ENV myName John Doe
    ENV myDog Rex The Dog
    ENV myCat=fluffy
</code></pre><p><strong>EXPOSE：指定于外界交互的端口</strong></p><pre tabindex=0><code>格式：
    EXPOSE &lt;port&gt; [&lt;port&gt;...]
示例：
    EXPOSE 80 443
    EXPOSE 8080
    EXPOSE 11211/tcp 11211/udp
注：
　　EXPOSE并不会让容器的端口访问到主机。要使其可访问，需要在docker run运行容器时通过-p来发布这些端口，或通过-P参数来发布EXPOSE导出的所有端口
</code></pre><p><strong>VOLUME：用于指定持久化目录</strong></p><pre tabindex=0><code>格式：
    VOLUME [&#34;/path/to/dir&#34;]
示例：
    VOLUME [&#34;/data&#34;]
    VOLUME [&#34;/var/www&#34;, &#34;/var/log/apache2&#34;, &#34;/etc/apache2&#34;
</code></pre><p>注：一个卷可以存在于一个或多个容器的指定目录，该目录可以绕过联合文件系统，并具有以下功能：
1 卷可以容器间共享和重用
2 容器并不一定要和其它容器共享卷
3 修改卷后会立即生效
4 对卷的修改不会对镜像产生影响
5 卷会一直存在，直到没有任何容器在使用它</p><p><strong>WORKDIR：工作目录，类似于cd命令</strong></p><pre tabindex=0><code>格式：
    WORKDIR /path/to/workdir
示例：
    WORKDIR /a  (这时工作目录为/a)
    WORKDIR b  (这时工作目录为/a/b)
    WORKDIR c  (这时工作目录为/a/b/c)
</code></pre><p>注：通过WORKDIR设置工作目录后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT、ADD、COPY等命令都会在该目录下执行。在使用docker run运行容器时，可以通过-w参数覆盖构建时所设置的工作目录。</p><p>**USER: ** <strong>指定运行容器时的用户名或 UID，后续的 RUN 也会使用指定用户。使用USER指定用户时，可以使用用户名、UID或GID，或是两者的组合。当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户</strong></p><pre tabindex=0><code class=language-dockfile data-lang=dockfile> 格式:
　　USER user
　　USER user:group
　　USER uid
　　USER uid:gid
　　USER user:gid
　　USER uid:group

 示例：
　　USER www
</code></pre><p>注：使用USER指定用户后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT都将使用该用户。镜像构建完成后，通过<code>docker run</code>运行容器时，可以通过-u参数来覆盖所指定的用户。</p><p><strong>ARG：用于指定传递给构建运行时的变量</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span>格式：<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>    ARG &lt;name&gt;<span style=color:#000;font-weight:700>[=</span>&lt;default value&gt;<span style=color:#000;font-weight:700>]</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>示例：<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>    ARG site<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>    ARG <span style=color:teal>build_user</span><span style=color:#000;font-weight:700>=</span>www<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>ONBUILD：用于设置镜像触发器</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span>格式：<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>　　ONBUILD <span style=color:#000;font-weight:700>[</span>INSTRUCTION<span style=color:#000;font-weight:700>]</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>示例：<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>　　ONBUILD ADD . /app/src<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span>　　ONBUILD RUN /usr/local/bin/python-build --dir /app/src<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span></code></pre></td></tr></table></div></div><p>注：当所构建的镜像被用做其它镜像的基础镜像，该镜像中的触发器将会被钥触发</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a href=/tags/docker target=_blank>docker</a></li><li><a href=/tags/Dockerfile target=_blank>Dockerfile</a></li></ul></div></article></div><footer id=footer><div>&copy; 2022 <a href=https://iforget.top>淡忘起初 By zaifeng</a></div><br><div><div class=github-badge><a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a></div><div class=github-badge><a href=# target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a></div></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[["$","$"]],processEscapes:!0}}</script><script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
<a id=rocket href=#top></a>
<script type=text/javascript src='/js/totop.js?v=0.0.0' async></script><style type=text/css>div.highlight{position:relative;margin:1em 0}.copy-code{display:none;position:absolute;top:4px;right:4px;color:rgba(255,255,255,.8);background:rgba(78,78,78,.8);border-radius:var(--radius);padding:0 5px;font:inherit;user-select:none;cursor:pointer;border:0;--radius:8px}div.highlight:hover .copy-code,pre:hover .copy-code{display:block}</style><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></div><div id=secondary><section class=widget><form id=search action=https://iforget.top/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://iforget.top>
<button type=submit class="submit icon-search"></button></form></section><section class=widget><h3 class=widget-title>Latest articles</h3><ul class=widget-list><li><a href=https://iforget.top/post/redisException/ title="Redis 的缓存异常处理" target=_blank>Redis 的缓存异常处理</a></li><li><a href=https://iforget.top/post/dockerfile/ title=Dockerfile target=_blank>Dockerfile</a></li><li><a href=https://iforget.top/post/dockernotes/ title="Docker 命名卷使用" target=_blank>Docker 命名卷使用</a></li><li><a href=https://iforget.top/post/redisnotes/ title=Redis笔记 target=_blank>Redis笔记</a></li><li><a href=https://iforget.top/post/GolangDlvDebug/ title=Golang代码调试 target=_blank>Golang代码调试</a></li><li><a href=https://iforget.top/post/MacVscodeSkill/ title=Mac下vscode技巧 target=_blank>Mac下vscode技巧</a></li></ul></section><section class=widget><h3 class=widget-title><a href=/categories/>Categories</a></h3><ul class=widget-list><li><a href=https://iforget.top/categories/docker/>docker (1)</a></li><li><a href=https://iforget.top/categories/golang/>golang (2)</a></li><li><a href=https://iforget.top/categories/redis/>redis (1)</a></li></ul></section><section class=widget><h3 class=widget-title><a href=/tags/>Tags</a></h3><div class=tagcloud><a href=https://iforget.top/tags/Dockerfile/>Dockerfile</a>
<a href=https://iforget.top/tags/aboutme/>aboutme</a>
<a href=https://iforget.top/tags/dlv/>dlv</a>
<a href=https://iforget.top/tags/docker/>docker</a>
<a href=https://iforget.top/tags/golang/>golang</a>
<a href=https://iforget.top/tags/life/>life</a>
<a href=https://iforget.top/tags/redis/>redis</a>
<a href=https://iforget.top/tags/volume/>volume</a>
<a href=https://iforget.top/tags/vscode/>vscode</a>
<a href=https://iforget.top/tags/%E8%A7%81%E8%AF%86/>见识</a></div></section><section class=widget><h3 class=widget-title>Links</h3><ul class=widget-list><li><a target=_blank href=https://juejin.cn/ title=掘金>掘金</a></li><li><a target=_blank href=https://geektutu.com/ title=极客兔兔>极客兔兔</a></li></ul></section><section class=widget><h3 class=widget-title>Meta</h3><ul class=widget-list><li><a href=https://iforget.top/index.xml>RSS</a></li></ul></section></div></div></div></div></body></html>